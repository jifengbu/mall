<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>赢销截拳道电子商城</title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/common.css" />
		<!--css-->
		<style>
			.brief {
				text-align: left;
				height: 80px;
				margin-top: 2px;
				margin-bottom: 2px;
				background-color: white;
			}

			.titleDIV {
				position: absolute;
				z-index: 1;
				top: 8px;
				max-width: 70%;
				/*width: 35%;*/
				left: 0;
				right: 0;
				bottom: 0;
				margin: auto;
				background-color: white;
			}

			.title {
				display: inline;
				font-size: 15px;
				color: #FF6060;
				padding-left: 10px;
				padding-right: 10px;
			}

			.xian {
				position: absolute;
				background: #CCCCCC;
				z-index: 0;
				width: 100%;
				top: 20px;
				height: 1px;
			}

			.goods-name-title {
				position: relative;
				text-align: center;
				width: 100%;
				height: 50px;
				background-color: white;
			}

			.contact-seller {
				float: left;
			}

			.flex-container {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-flex-flow: row wrap;
				justify-content: space-between;
				text-align: center;
			}

			.mui-control-content {
				background-color: white;
				min-height: 215px;
			}

			.mui-control-content .mui-loading {
				margin-top: 50px;
			}

			.img-info img {
				width: 100%;
				height: auto;
				margin: 0;
			}

			.button-custom {
				float: left;
				width: 25%;
				height: 40px;
				color: white;
				border-right: 1px solid white;
				background-color: orange;
			}

			.button-custom:hovfer {
				background-color: red;
				color: black;
			}

			#zan {
				height: auto;
				position: absolute;
				left: 8%;
				margin-top: -18%;
				display: none;
			}
			.a-btn {
				float: left;
				width: 25%;
				height: 36px;
			}
			.a-btn span {
				margin-left: 45%;
				color: #fff;
				line-height: 36px;
				font-size: 14px;
			}
			.btn-phone {
				background: url(../../img/goods-detail/consultation_normal.png) no-repeat;
				background-size: 100% 100%;
			}
			.btn-phone:active {
				background: url(../../img/goods-detail/consultation_press.png) no-repeat;
				background-size: 100% 100%;
			}
			.btn-share {
				background: url(../../img/goods-detail/share_normal.png) no-repeat;
				background-size: 100% 100%;
			}
			.btn-share:active {
				background: url(../../img/goods-detail/share_press.png) no-repeat;
				background-size: 100% 100%;
			}
			.btn-shop {
				background: url(../../img/goods-detail/go_to_the_shop_normal.png) no-repeat;
				background-size: 100% 100%;
			}
			.btn-shop:active {
				background: url(../../img/goods-detail/go_to_the_shop_press.png) no-repeat;
				background-size: 100% 100%;
			}
			.ask-text {
				color: white;
				font-size: 12px;
				position: absolute;
				left: 15%;
				margin-top: 10px;
			}

			.choice-text {
				color: white;
				font-size: 12px;
				position: absolute;
				top: 0;
				left: 50%;
				margin-top: 10px;
			}

			.choose-result {
				width: 100%;
				height: 100px;
				background-color: #EEEEEE;
			}

			.choose-para-container {
				overflow-y: auto;
				height: 240px;
			}

			.choose-para {
				padding-bottom: 10px;
				background-color: #EEEEEE;
				border-bottom-style: solid;
				border-bottom-width: 1px;
				border-color: gray;
			}

			.choose-para button {
				height: 35px;
				width: 30%;
				margin-left: 10px;
				border-radius: 5px;
				background-color: #A2A2A2;
			}

			.choose-para button.choose-active {
				color: #fff;
				background: -webkit-linear-gradient(top, #FCBD3D, #F88D31);
				background: -moz-linear-gradient(top, #FCBD3D, #F88D31);
				background: linear-gradient(top, #FCBD3D, #F88D31);
			}

			.choose-quantity {
				height: 60px;
				background-color: #EEEEEE;
			}

			.choose-goods {
				position: fixed;
				bottom: 0;
				width: 100%;
				height: 450px;
				background-color: #EEEEEE;
				z-index: 1050;
				/*opacity: 10;*/
			}

			.choose-result .img-back {
				position: relative;
				top: -30px;
				left: 10px;
				height: 120px;
				width: 120px;
				text-align: center;
				float: left;
				background-color: gainsboro;
				border-radius: 10px;
			}

			.choose-result .choose-result-data {
				position: relative;
				left: 20px;
				/*width: 120px;*/
				height: 100px;
				float: left;
				/*background-color: red;*/
			}

			.choose-result-data p {
				color: red;
				font-size: large;
				margin-top: 20px;
			}

			.choose-result img {
				height: 100px;
				width: 100px;
				text-align: center;
				margin-top: 10px;
				border-radius: 10px;
			}

			.myDiv {
				margin-bottom: 10px;
				clear: both;
				word-break: break-all;
				word-wrap: break-word;
			}

			.share {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				z-index: 1050;
				margin: 0 auto;
				text-align: center;
			}

			.share img {
				float: right;
				width: 272px;
				height: 264px;
				margin-top: 5px;
				margin-right: 25px;
			}
			.mui-bar-tab .mui-tab-item.add-shop-back {
				width:45%;
				background: url(../../img/goods-detail/add_to_cart_normal.png) no-repeat;
				background-size: 100% 100%;
				color: #fff;
			}
			.mui-bar-tab .mui-tab-item.add-shop-back.mui-active {
				background: url(../../img/goods-detail/add_to_cart_press.png) no-repeat;
				background-size: 100% 100%;
			}
		</style>

	</head>

	<body style="padding: 3px;background:white ;">

		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<a id="title_right_goChoosePage" class="mui-icon mui-pull-right"><img style="width: 26px;height: 24px;" src="../../img/goods-detail/shopping_cart_press.png"></a>
			<h1 class="mui-title">商品详情</h1>
		</header>
		<!--底部导航-->
		<nav class="mui-bar mui-bar-tab">
			<a style="position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/gd_collect_love_bg.png);background-size: 100% 100%;" id="addCollect" class="mui-tab-item" href="#">
				<div style="position: relative; width: 100%; height: 40px;">
					<img id="collect_img" src="../../img/goods-detail/gd_collection_1.png" width="58%" height="80%" style="margin-top: -1px;"> </img>
					<span style="position: absolute;display:inline-block;text-align:center;width:100%;color: white; bottom: -8px; left: 0;font-size: 13px;">收藏</span>
				</div>
			</a>
			<a style="position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/gd_collect_love_bg.png);background-size: 100% 100%;" id="addLikeData" class="mui-tab-item" href="#">
				<div style="position: relative; width: 100%; height: 40px;">
					<img id="love_img" src="../../img/goods-detail/gd_love_1.png" width="60%" height="85%" style="margin-top: -2px;"> </img>
					<span style="position: absolute;display:inline-block;text-align:center;width:100%;color: white; bottom: -8px; left: 0;font-size: 13px;">喜爱</span>
				</div>
			</a>
			<a id="goShopingCart" class="mui-tab-item add-shop-back" href="#">
				<!--<p style="position:absolute;left:0;top:0;bottom:0;right:0;margin: auto;margin-top:16px;color: white;font-size: 17px;">加入购物车</p>-->
				加入购物车
			</a>
			<a id="goChoosePage" class="mui-tab-item add-shop-back" href="#">
				<!--<p style="position:absolute;left:0;top:0;bottom:0;right:0;margin: auto;margin-top:16px;color: white;font-size: 17px;">立即购买</p>-->
				立即购买
			</a>
		</nav>
		<div class="mui-content" style="background: white;">
			<!--选择商品-->
			<div class="choose-goods hide"></div>
			<div id="goods_name" class="goods-name-title">
				<!--<div class="titleDIV" hidden="hidden">
					<p class="title">商品名称</p>
				</div>
				<div class="xian"></div>-->
			</div>
			<!--轮播商品图片区-->
			<div id="bannerImg" class="mui-slider" style="margin-top: 6px;">
				<!--<img src="../../img/home/banner.png" style="width:100%;">-->
			</div>
			<!--商品简介-->
			<div id="IntroducesAndPraise" class="brief">
				<!--<div style="width:65%;float: left;text-align: left;border-color: gray;margin-top: 10px;margin-left: 10px;">
					<div></div>
					<div style="margin-top: 10px;">
						<span style="color: red;">¥:</span><span style="text-decoration: line-through;margin-left: 20px;">原价：¥</span>
					</div>
				</div>
				<div id="gotoPraise" style="float: right;width: 30%;height: 40px;background-color: white;margin-top: 30px;">
					<img src="../../img/order/evaluate.png" width="20" height="25" align="center" style="margin: auto;"></img>
				</div>-->
			</div>
			<!--咨询、分享、去店铺、评论-->
			<!--<div id="btn-div" class="myDiv" style="clear: both;margin-top: 15px;width: 100%;height:40px;">
				<!--<button id="btn-consult" onclick="gotoConsult()" style="background:url(../../img/goods-detail/consultation_normal_1.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span id="telPhone" class="choice-text">咨询</span></button>
				<button id="btn-share" onclick="gotoShare()" style="background:url(../../img/goods-detail/share_normal_1.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span class="choice-text">分享</span></button>
				<button id="btn-shop" onclick="gotoShop" style="background:url(../../img/goods-detail/go_to_shop_normal.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span class="choice-text">去店铺</span></button>
				<button id="btn-praise" onclick="gotoPraise" style="background:url(../../img/goods-detail/love_buttion.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span class="choice-text">121231</span><span style="position: absolute;top: 0;left: 5%;margin-top: 7px;"><img src="../../img/goods-detail/love_normal.png" width="60%" height="50%" alt="" /></span></button>-->
			<!--</div>-->

			<div id="btn-div" style="clear: both;margin-top: 10px;width: 100%;height: 40px;overflow: hidden;">
				<!--<a href="#btn-consult">
					<div style="float:left;position:relative;width: 25%;height: 40px;background-size:100% 100%;background: url(../../img/distributor/long_button_tx_normal.png);">
						<div style="position: absolute;top: 0px; left: 50%;margin-left: -40px;">
							<img height="37px" src="../../img/goods-detail/consultation_normal_1.png"></img>
						</div>
						<div style="line-height: 40px; position: absolute;top: 0; left: 50%;">
							<p style="color: white;">咨询 </p>
						</div>
					</div>
				</a>
				<a href="#btn-consult">
					<div style="float:left;position:relative;width: 25%;height: 40px;background-size:100% 100%;background: url(../../img/distributor/long_button_tx_normal.png);">
						<div style="position: absolute;top: 0px; left: 50%;margin-left: -40px;">
							<img height="37px" src="../../img/goods-detail/share_normal_1.png"></img>
						</div>
						<div style="line-height: 40px; position: absolute;top: 0; left: 50%;">
							<p style="color: white;">分享</p>
						</div>
					</div>
				</a>
				<a href="#btn-consult">
					<div style="float:left;position:relative;width: 25%;height: 40px;background-size:100% 100%;background: url(../../img/distributor/long_button_tx_normal.png);">
						<div style="position: absolute;top: 0px; left: 50%;margin-left: -40px;">
							<img height="37px" src="../../img/goods-detail/go_to_shop_normal.png"></img>
						</div>
						<div style="line-height: 40px; position: absolute;top: 0; left: 50%;">
							<p style="color: white;font-size: 13px;">去店铺 </p>
						</div>
					</div>
				</a>
				<a href="#btn-consult">
					<div style="float:left;position:relative;width: 25%;height: 40px;background-size:100% 100%;background: url(../../img/distributor/long_button_tx_normal.png);">
						<div style="position: absolute;top: 0px; left: 50%;margin-left: -40px;">
							<img height="30px" style="margin-top: 6px;" src="../../img/goods-detail/love_normal.png"></img>
						</div>
						<div style="line-height: 40px; position: absolute;top: 0; left: 50%;">
							<p style="color: white;">12120</p>
						</div>
					</div>
				</a>-->
			</div>

			<div id="goodsIntroduces" style="clear: both;background: white;margin-top: 20px;">
				<!--<div style="margin-top: 10px;">
					<br>
				</div>-->
				<!--<div class="goods-name-title">
					<div class="titleDIV">
						<p class="title">商品介绍</p>
					</div>
					<div class="xian"></div>
				</div>-->
				<!--<p style="margin:5px;padding: 15px; background: #FF5053;color: black;"></p>-->
				<!--<img src="../../img/home/banner.png" style="width: 100%;">-->
			</div>
			<div class="share over-share hide">
				<img src="../../img/distributor/arrow.png" />
			</div>
			<!--<div class="case hide">
				<div class="top">拨打提示</div>
				<div id="tel_div" class="center">-->
			<!--<a href="tel:10086">10086</a>-->
			<!--</div>
				<div class="footer">
					<div class="left cancel">取&nbsp;&nbsp;消</div>
					<div class="right confirm">拨&nbsp;&nbsp;打</div>
				</div>
			</div>-->
		</div>

	</body>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script src="../../js/thirdparty/mui.min.js"></script>
	<script src="../../js/thirdparty/zepto.1.1.6.min.js"></script>
	<script src="../../js/utils/app.js"></script>
	<!--<script type="text/javascript" src='https://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>-->
	<script>
		"use strict";
		mui.init({
			swipeBack: true
		});

		function gotoChoosePage() {
			$("body").append('<div class="modal-backdrop close-shop"></div>');
			$(".choose-goods").show();
		}

		function gotoShare() {
			$("body").append('<div class="modal-backdrop over-share"></div>');
			$(".share").show();
			setTimeout(function() {
				$(".modal-backdrop").remove();
				$(".share").hide();
			}, 3000);
		}

		function gotoShop() {
			//如果是从商铺界面过来的，会直接返回,不再新建页面
			var str = app.router.from + '';
			if (!app.router.isBack && str.endWith('store.html')) {
				mui.back();
			} else {
				var data = {
					shopID: saved.data.shopID,
				}
				app.router.showView('../personal/store.html', data, saved);
			}
		}

		function gotoPraise() {
			var param = {
				goodsID: params.goodsID,
				title: saved.data.goodsName
			};
			app.router.showView('../goods-detail/appraise-list.html', param, saved);
		}
		String.prototype.endWith = function(endStr) {
				var d = this.length - endStr.length;
				return (d >= 0 && this.lastIndexOf(endStr) == d)
			}
			/*喜爱亦点赞*/
		function sumitAddLikeData() {
			var url = app.route.ROUTE_GET_LIKE_GOODS_DATA;
			var data = {
				goodsID: params.goodsID,
				openID: app.global.get("wechatInfo").openID,
			};
			app.utils.post({
				url: url,
				data: data,
				success: sumitLikeSuccess,
			});
		}

		function sumitLikeSuccess(data) {
			if (data.success === true) {
				//点赞成功以后自动加一
				$("#zan").show(300);
				setTimeout(function() {
					$("#zan").hide();
				}, 1000)
				var oldNum = $("#text-praise").text();
				var newNum = parseInt(oldNum.toString()) + 1;
				$("#text-praise").text(newNum);
				//改变喜爱样式
				$('#love_img').attr('src', '../../img/goods-detail/gd_love_2.png');
				//$('#addLikeData').css('style', 'position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/love_pressl2_2.png);background-size: 100% 100%;');
				mui.toast("添加喜爱成功");
				saved.data.isConllection = '1';
			} else {
				hadClick_like = false;
				mui.toast("添加喜爱失败，请稍后重试");
			}
		}
		/*添加收藏*/
		function sumitAddMyCollectData() {
			var url = app.route.ROUTE_GET_SUMIT_COLLECT_GOODS_DATA;
			var data = {
				goodsID: params.goodsID,
				openID: app.global.get("wechatInfo").openID,
			};
			app.utils.post({
				url: url,
				data: data,
				success: sumitCollectSuccess,
			});
		}

		function sumitCollectSuccess(data) {
			if (data.success === true) {
				//改变收藏样式
				if (data.context.isConllection == 1) {
					$('#collect_img').attr('src', '../../img/goods-detail/gd_collection_2.png');
					//$('#addCollect').css('style', 'position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/collection_press2_2.png);background-size: 100% 100%;');
					mui.toast("添加收藏成功");
					saved.data.isConllection = '1';
				} else if (data.context.isConllection == 0) {
					$('#collect_img').attr('src', '../../img/goods-detail/gd_collection_1.png');
					//$('#addCollect').css('style', 'position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/collection_normal.png);background-size: 100% 100%;');
					mui.toast("已取消收藏");
					saved.data.isConllection = '0';
				}
				app.router.setBackParameter({
					'shouldUpdateListData': true
				});
			} else {
				mui.toast("收藏操作失败，请稍后重试");
			}
			hadClick_collect = false;
		}
		/*获取商品详情数据*/
		function getIntegralExchangeData() {
			var url = app.route.ROUTE_GET_GOODS_DETAILS_DATA;
			var data = {
				goodsID: params.goodsID,
				openID: app.global.get("wechatInfo").openID,
			};
			app.utils.post({
				url: url,
				data: data,
				success: getGoodsDetailsDataSuccess,
			});
		}

		function getGoodsDetailsDataSuccess(data) {
			if (data.success === true && data.context) {
				var dataContext = data.context;
				saved.data = dataContext;
				showPage(dataContext);
			}
		}

		function showBannerImg(imgs) {
			var html1 = '',
				html2 = '';
			if (imgs == "") {
				return;
			}
			var imgURL = imgs;
			html1 += '<div class="mui-slider-item mui-slider-item-duplicate">';
			html1 += '	<a href="#">';
			html1 += '		<img src="' + imgURL[0] + '"style="height: 220px;"/>';
			html1 += '	</a>';
			html1 += '</div>';
			for (var i in imgURL) {
				var img = imgURL[i];
				html1 += '<div class="mui-slider-item">';
				html1 += '	<a href="#">';
				html1 += '		<img src="' + img + '"style="height: 220px;"/>';
				html1 += '	</a>';
				html1 += '</div>';
				html2 += '<div class="mui-indicator' + ((i == 0) ? " mui-active" : "") + '"></div>';
			}
			html1 += '<div class="mui-slider-item mui-slider-item-duplicate">';
			html1 += '	<a href="#">';
			html1 += '		<img src="' + imgURL[0] + '"style="height: 220px;"/>';
			html1 += '	</a>';
			html1 += '</div>';
			html1 = '<div class="mui-slider-group mui-slider-loop">' + html1 + '</div>';
			html2 = '<div class="mui-slider-indicator">' + html2 + '</div>';
			$('#bannerImg').html(html1 + html2);
			mui('#bannerImg').slider();
		}

		function showGoodsIntroducesData(data) {
			if (data.goodsIntroducesImgURLs == "") {
				return;
			}
			var IntroducesImgURL = data.goodsIntroducesImgURLs;
			var html1 = '';
			html1 += '<div class="goods-name-title">';
			html1 += '<div class="titleDIV"><p class="title">商品介绍</p></div>';
			html1 += '<div class="xian"></div></div>';
			// html1 += '<p style = "padding: 10px;color: black; word-wrap:break-word; word-break:break-all; line-height:25px;font-size: 18px;"><span style = "background: #FF6060;">' + data.goodsIntroduces + '</span></p>';
			for (var i in IntroducesImgURL) {
				var img = IntroducesImgURL[i];
				html1 += '<img src="' + img + '"style="width: 100%;"/>';
			}
			$('#goodsIntroduces').html(html1);
			mui('#goodsIntroduces').slider();
		}

		function showGoodsDetailsData(data) {
			var htm1_1 = '';
			var salePrice = '';
			var price = '';
			var introduces = '';
			if (data.goodsSalePrice != null && data.goodsSalePrice != 0 && data.goodsSalePrice != 0.00 && data.goodsSalePrice != '0.00' && data.goodsSalePrice != '0') {
				salePrice = '￥' + data.goodsSalePrice;
				if (data.goodsPrice != null && data.goodsPrice != 0 && data.goodsPrice != 0.00 && data.goodsPrice != '0.00' && data.goodsPrice != '0') {
					price = '原价：￥' + data.goodsPrice;
				} else {
					price = '';
				}
			} else {
				salePrice = '￥' + data.goodsPrice;
			}
			if (data.goodsIntroduces != null && data.goodsIntroduces != 'null') {
				introduces = data.goodsIntroduces;
			}
			htm1_1 += '<div style="width:65%;float: left;text-align: left;border-color: gray;margin-top: 10px;margin-left: 10px;">';
			htm1_1 += '<div style="font-size: 15px;overflow : hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;">' + introduces + '</div>';
			htm1_1 += '<div style="margin-top: 10px;">';
			htm1_1 += '<span style="color: red;font-size: 24px;">' + salePrice + '</span>';
			htm1_1 += '<span style="font-size: 13px;text-decoration: line-through;margin-left: 20px;">' + price + '</span>';
			htm1_1 += '</div></div>';
			htm1_1 += '<div id="gotoPraise" style="float: right;width: 30%;height: 40px;background-color: white;margin-top: 30px;">';
			//根据数据设置评分
			var temp = data.score.toString();
			if (temp.indexOf(".") > 0) {
				var str = temp.split(".");
				var strInt = parseInt(str[0]);
				if (strInt < 5) {
					for (var i = 0; i < strInt; i++) {
						htm1_1 += '<img src="../../img/goods-detail/comments_normal_1.png" width="25" height="25" align="center" style="margin: auto;"></img>';
					}
					var temp = 5 - strInt; //得到剩余的需要设置的空心图数量
					if (parseInt(str[1]) >= 5) {
						temp = temp - 1; //如果有半颗就减一，保证空心图的数量正确
						htm1_1 += '<img src="../../img/goods-detail/comments_normal_2.png" width="25" height="25" align="center" style="margin: auto;"></img>';
					}
					//if (temp >= 1) {
					//for (var i = 0; i < temp; i++) {
					//htm1_1 += '<img src="../../img/order/evaluate.png" width="25" height="25" align="center" style="margin: auto;"></img>';
					//} }
				} else if (strInt >= 5) {
					//超出时只设置五颗星
					for (var i = 0; i < 5; i++) {
						htm1_1 += '<img src="../../img/goods-detail/comments_normal_1.png" width="25" height="25" align="center" style="margin: auto;"></img>';
					}
				}
			} else {
				var tp = parseInt(temp);
				if (tp == 0) {
					htm1_1 += '<div style="font-size: 12px;">&nbsp;&nbsp;暂无评论</div>';
				} else {
					//小数点后为0（如： 3.0 ）时， 转换的结果会去掉后面的零，只得到整数
					if (tp <= 5) {
						for (var i = 0; i < tp; i++) {
							htm1_1 += '<img src="../../img/goods-detail/comments_normal_1.png" width="25" height="25" align="center" style="margin: auto;"></img>';
						}
						//var tpTemp = 5 - tp;
						//if (tpTemp >= 1) {
						////设置剩余的空心图
						//for (var j = 0; j < tpTemp; j++) {
						//htm1_1 += '<img src="../../img/order/evaluate.png" width="25" height="25" align="center" style="margin: auto;"></img>';
						//} }
					} else if (tp >= 5) {
						//超出时只设置五颗星
						for (var i = 0; i < 5; i++) {
							htm1_1 += '<img src="../../img/goods-detail/comments_normal_1.png" width="25" height="25" align="center" style="margin: auto;"></img>';
						}
					}
				}
			}
			htm1_1 += '</div>';
			$('#IntroducesAndPraise').html(htm1_1);
			mui('#IntroducesAndPraise').slider();
			//进入评论列表
			$("#gotoPraise").on('tap', function() {
				gotoPraise();
			});
		}

		function showGoodsName(data) {
			var html_name = '';
			var name = '';
			if (data.goodsName != null && data.goodsName != 'null') {
				name = data.goodsName;
			}
			html_name += '<div class="titleDIV">';
			html_name += '<p class="title" style="overflow : hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;">' + name + '</p></div>';
			html_name += '<div class="xian"></div>';
			$('#goods_name').html(html_name);
			mui('#goods_name').slider();
			if (data.isConllection == 1) {
				$('#collect_img').attr('src', '../../img/goods-detail/gd_collection_2.png');
				//$('#addCollect').css('style', 'position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/collection_press2_2.png);background-size: 100% 100%;');
			}
			if (data.isPraise == 1) {
				hadClick_like = true;
				$('#love_img').attr('src', '../../img/goods-detail/gd_love_2.png');
				//$('#addLikeData').css('style', 'position:relative;height: 40px;width:20%;background: url(../../img/goods-detail/love_pressl2_2.png);background-size: 100% 100%;');
			}
		}

		function showShareData(data) {
			var html_sd = '';
			//			html_sd += '<a href="tel:10086" style="background:url(../../img/goods-detail/consultation_normal_1.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span id="telPhone" class="ask-text">咨询</span></a>';
			//			html_sd += '<button id="btn-share" onclick="gotoShare()" style="background:url(../../img/goods-detail/share_normal_1.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span class="choice-text">分享</span></button>';
			//			html_sd += '<button id="btn-shop" style="background:url(../../img/goods-detail/go_to_shop_normal.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline"><span class="choice-text">去店铺</span></button>';
			//			html_sd += '<button id="btn-praise" style="background:url(../../img/goods-detail/love_buttion.png);background-size:100% 100%;float:left;width: 25%;height:100%;display:inline">';
			//			//html_sd += data.loves + '</span><span style="position: absolute;top: 0;left: 5%;margin-top: 7px;"><img src="../../img/goods-detail/love_normal.png"width="60%" height="50%" alt="" /></span></button>';
			//			html_sd += '<p id="text-praise" style="color: white;margin-top: 3px;"><img width=25 height:25 src="../../img/goods-detail/love_normal.png" align=left border=0><img id="zan" src="../../img/goods-detail/love_press.png"><span>' + data.loves + '</spantext-praise></p></button>';
			html_sd += '<a href="tel:' + data.phone + '">'+
					   '	<div class="a-btn btn-phone">'+
					   '		<span>咨询</span>'+
					   '	</div>'+
			           '</a>'+
			           '<a id="btn-share">'+
					   '	<div class="a-btn btn-share">'+
					   '		<span>分享</span>'+
					   '	</div>'+
					   '</a>'+
					   '<a id="btn-shop">'+
					   '	<div class="a-btn btn-shop">'+
					   '		<span>去店铺</span>'+
					   '	</div>'+
				       '</a>'+
					   '<a id="btn-praise">'+
					   '	<div style="position: relative;float:left;width: 25%;height: 36px;background-size:100% 100%;background: url(../../img/distributor/long_button_tx_normal.png);">'+
			 		   '		<div style="position: absolute;top: 0px; left: 50%;margin-left: -40px;">'+
			 		   '			<img id="zan" width="50px" height="50px" style="margin-top: -3px;margin-left: -3px;" src="../../img/goods-detail/love_press.png"/>'+
					   '			<img height="26px" style="margin-top: 6px;" src="../../img/goods-detail/love_normal.png"></img>'+
					   '		</div>'+
					   '		<div style="line-height: 36px; position: absolute;top: 0; left: 50%;">'+
					   '			<p  id="text-praise" style="color: white;">' + data.loves + '</p>'+
					   '		</div>'+
					   '	</div>'+
					   '</a>'+
					   '<div style="clear:both;"></div>';
			$('#btn-div').html(html_sd);
			mui('#btn-div').slider();
			//分享、去店铺
			$("#btn-share").on('tap', function() {
				gotoShare();
			});
			//去店铺
			$("#btn-shop").on('tap', function() {
				gotoShop();
			});
			var html_tel = '';
			html_tel += '<a href="tel:' + data.phone + '">' + data.phone + '</a>';
			$('#tel_div').html(html_tel);
			mui('#tel_div').slider();
		}

		function showPage(data) {
			showGoodsName(data); //商品名称
			showShareData(data); //商品喜爱人数
			showGoodsDetailsData(data); //商品价格、评分部分
			showGoodsIntroducesData(data); //商品介绍部分
			showBannerImg(data.goodsImgURLs); //顶部滚动图片部分
		}

		function getShoppingData() {
			var url = app.route.ROUTE_GET_SHOPPING_DATA;
			if (params && typeof(params.goodsID) != "undefined") {
				saved.goodsID = params.goodsID;
			}
			var data = {
				openID: app.global.get("wechatInfo").openID,
				goodsID: saved.goodsID,
				// pageNo: '0',
			};
			app.utils.post({
				url: url,
				data: data,
				success: getShoppingDataSuccess
			});
		};

		function getShoppingDataSuccess(data) {
			if (data.success === true && data.context) {
				var context = data.context;
				saved.code = context.code;
				saved.goodsID = context.goodsID;
				saved.goodsImg = context.goodsImg;
				priceDic = context.price;
				var html = '';
				html = getChooseGoodsView(context);
				$('.choose-goods').html(html);
				mui('.mui-numbox').numbox();
				singlePrice = getChooseGoodsTotalPrice(priceDic);
				var price = parseFloat(singlePrice).toFixed(2);
				$('#price').text('¥:' + price);
//				attribute.push(singlePrice);
				saved.goodsPrice = singlePrice;
				gotoChoosePage()
			}
		};

		function addShoppingCart() {
			var url = app.route.ROUTE_ADD_SHOPPING_CART;
			var data = {
				openID: app.global.get("wechatInfo").openID,
				goodsID: params.goodsID,
				attribute: params.goodsID+'-'+attribute.join('-') + '-' + singlePrice,
				goodsNum: $('#chooseGoodsNum').val(),
			};
			app.utils.post({
				url: url,
				data: data,
				success: addShoppingCartSuccess
			});
		};

		function addShoppingCartSuccess(data) {
			if (data.success === true) {
				mui.toast("加入购物车成功");
				app.global.set('needUpdateTrolley', true);
				closeChooseGoodsView();
			} else {
				mui.toast("加入购物车失败，请稍后重试");
			}
		};
		var priceDic;
		var singlePrice;
		var attribute = new Array();
		/*getShoppingData();*/
		var chooseData = new Object();

		function getChooseGoodsView(item) {
			chooseData["price"] = 0;
			chooseData["goodsID"] = item.goodsID;
			chooseData["attr"] = new Array();
			attribute[0] = item.goodsID;
			var html = '';
			html += '<div class="choose-result">'
			html += '<div class="img-back">'
			html += '<img src="' + item.goodsImg + '"></img>'
			html += '</div>'
			html += '<div class="choose-result-data">'
			html += '<p id="price">¥：8979.00</p>'
				/*html += 			'<p id="stock">库存：897</p>'*/
				/*html += 			'<p id="option">请选择</p>'*/
			html += '</div>'
			html += '<span class="mui-icon mui-icon-close" onclick="closeChooseGoodsView()" style="float: right;margin: 10px 10px 0 0;"></span>'
			html += '</div>'
			html += '<div style="clear: both;"></div>'
			html += '<div class="choose-para-container">'
			for (var attrKey in item.code) {
				html += '<div class="choose-para" style="margin: 5px;" id="' + attrKey + '">'
				html += '<div class="choose-goods-attr" style="font-size:15px;color:black;">' + item.code[attrKey].primary + '</div>'
				for (var secondKey in item.code[attrKey].secondary) {
					if (secondKey === item.code[attrKey].default) {
						html += '<button id="' + secondKey + '" style="background-color: darkorange;color: white;margin-bottom:10px">' + item.code[attrKey].secondary[secondKey] + '</button>'
					} else {
						html += '<button style="margin-bottom:10px" id="' + secondKey + '">' + item.code[attrKey].secondary[secondKey] + '</button>'
					}
				}
				chooseData["attr"][attrKey] = item.code[attrKey].default;
				attribute.push(item.code[attrKey].default);
				html += '</div>'
			}
			html += '<div class="choose-quantity">'
			html += '<p style="float: left;margin-left: 15px;margin-top: 15px;font-size:15px;color:black">购买数量：</p>'
			html += '<div class="mui-numbox" data-numbox-step="1" data-numbox-min="1" style="float: right;margin-right: 5px;margin-top: 9px;">'
			html += '<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>'
			html += '<input id="chooseGoodsNum" class="mui-input-numbox" type="number" value="1" />'
			html += '<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>'
			html += '</div>'
			html += '</div>'
			html += '</div>'
			html += '<button class="mui-btn mui-btn-block chooseSureBtn" style="color: white;background-color: red;position: fixed;bottom: 0;margin-bottom:0">确认</button>'
			return html;
		}

		function getChooseGoodsTotalPrice(price) {
			attribute.splice(1);
			var priceDic = price;
			var i = 0;
			for (var attKey in chooseData["attr"]) {
				i++;
				attribute.push(chooseData["attr"][attKey]);
				if(i!=chooseData["attr"].length){
					priceDic = priceDic[chooseData["attr"][attKey]];
				}	
			}
			return priceDic;
		}

		function closeChooseGoodsView() {
			$(".modal-backdrop").hide();
			$(".choose-goods").hide();
		}
		//		getShoppingData();
		function getChooseGoodsViewbak(item) {
			var html = '';
			html += '<div class="choose-result">'
			html += '<div class="img-back">'
			html += '<img src="../../img/goods-detail/muwu.jpg"></img>'
			html += '</div>'
			html += '<div class="choose-result-data">'
			html += '<p>¥：8979.00</p>'
			html += '<p>库存：897</p>'
			html += '<p>请选择规格</p>'
			html += '</div>'
			html += '<span class="mui-icon mui-icon-close close-shop" style="float: right;margin: 10px 10px 0 0;"></span>'
			html += '</div>'
			html += '<div style="clear: both;"></div>'
			for (var attrKey in item.code) {
				html += '<div class="choose-para">'
				html += '<div>' + item.code[attrKey].primary + '</div>'
				for (var secondKey in item.code[attrKey].secondary) {
					if (secondKey == 1 || secondKey == 4) {
						html += '<button class="choose-active"><input type="hidden" name="secondKey" value="' + secondKey + '" />' + item.code[attrKey].secondary[secondKey] + '</button>'
					} else {
						html += '<button><input type="hidden" name="secondKey" value="' + secondKey + '" />' + item.code[attrKey].secondary[secondKey] + '</button>'
					}
				}
				html += '</div>'
			}
			html += '<div class="choose-quantity">'
			html += '<h3 style="float: left;margin-top: 20px;">购买数量：</h3>'
			html += '<div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" style="float: right;margin-right: 5px;margin-top: 15px;">'
			html += '<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>'
			html += '<input class="mui-input-numbox" type="number" value="1" />'
			html += '<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>'
			html += '</div>'
			html += '</div>'
			html += '<button class="mui-btn mui-btn-block addShopcar" style="background-color: red;position: fixed;bottom: 0;margin-bottom:0">确认</button>';
			//加入购物车
			// if (chooseGoodsType === 1) {
			//	 html += '<button class="mui-btn mui-btn-block" style="background-color: red;position: fixed;bottom: 0;margin-bottom:0" onclick="gotoShopingTrolleyPage()">确认</button>'
			//	 } else if (chooseGoodsType === 2) { //立即购买
			//	 html += '<button class="mui-btn mui-btn-block" style="background-color: red;position: fixed;bottom: 0;margin-bottom:0"onclick="gotoSettlementPage()">确认</button>'
			// }
			return html;
		}
		// $(".choose-goods").on('tap', '.choose-para button', function() {
		// $(this).parent().find("button").removeClass("choose-active");
		// $(this).addClass("choose-active");
		// });
		//注册选择按钮事件
		$('.mui-content').on('tap', '.choose-para button', function() {
			$(this).siblings().css({
				"background-color": "#A2A2A2",
				"color": "black"
			});
			$('.choose-goods-attr').css("background-color", "#EEEEEE");
			$(this).css({
				"background-color": "darkorange",
				"color": "white"
			});
			chooseData["attr"][this.parentNode.id] = this.id;
			singlePrice = getChooseGoodsTotalPrice(priceDic);
			var ntotal = 0;
			ntotal = singlePrice * $('#chooseGoodsNum').val();
			if (ntotal == NaN) {
				ntotal = 0;
			}
			$('#price').text('¥:' + ntotal.toFixed(2));
		});
		//注册确定按钮事件
		$(".mui-content").on('tap', '.chooseSureBtn', function() {
			if (chooseGoodsType === 1) {
				addShoppingCart()
			} else {
				saved.goodsNum = $('#chooseGoodsNum').val();
				saved.goodsDecStr = attribute.slice(1, attribute.length).join('-');
				var data = {
					goodsImg: saved.goodsImg,
					goodsID: saved.goodsID,
					goodsName: saved.data.goodsName,
					goodsNum: saved.goodsNum,
					goodsDecStr: saved.goodsDecStr,
					goodsPrice: saved.goodsPrice,
					goodsDes: getGoodsAttrDec(saved.code, saved.goodsDecStr)
				}
				app.global.set("goodsList", [data]);
				var server = window.location.href.split('?')[0].split('goods-details.html')[0];
				if (server[server.length - 1] != '/') {
					server += '/';
				}
				var url = server + 'settlement.html';
				var parames = {
					goodsID: params.goodsID,
				}
				app.router.showView('https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx6f776c4a6e6d5ce5&redirect_uri=' + url + '&response_type=code&scope=snsapi_base&state=123#wechat_redirect', parames, saved);
			}
		});
		$(".mui-content").on('change', '#chooseGoodsNum', function() {
			var ntotal = 0;
			ntotal = singlePrice * $(this).val();
			if (ntotal == NaN) {
				ntotal = 0;
			}
			$('#price').text('¥:' + ntotal.toFixed(2));
		});

		function getGoodsAttrDec(code, dec) {
			var discr = '';
			var decStr = dec.split('-');
			for (var ki in decStr) {
				for (var k in code) {
					var secondary = code[k].secondary;
					for (var kj in secondary) {
						if (kj == decStr[ki]) {
							discr += code[k].primary + ':' + secondary[kj] + ';';
							break;
						}
					}
				}
			}
			return discr.substr(0, discr.length - 1);
		}

		function submitAddShoppingcar(data) {
			if (data.success === true) {
				mui.toast("添加成功");
				app.router.showView('../goods-detail/shopping-trolley.html', {}, saved);
			} else {
				mui.toast("添加失败");
			}
		}
		$("body").on('tap', '.close-shop', function() {
			$(".modal-backdrop").remove();
			$(".choose-goods").hide();
		});
		//标题栏右侧进入购物车
		$("#title_right_goChoosePage").on('tap', function() {
			var parames = {
				goodsID: params.goodsID,
			}
			app.router.showView('shopping-trolley.html', parames, saved);
			// gotoChoosePage();
		});
		//底部导航的监听事件
		$("#addCollect").on('tap', function() {
			if (hadClick_collect == false) {
				hadClick_collect = true; //表示已经正在请求数据了
				sumitAddMyCollectData();
			}
		});
		$("#addLikeData").on('tap', function() {
			if (hadClick_like == false) {
				hadClick_like = true; //表示已经正在请求数据了
				sumitAddLikeData();
			}
		});
		var chooseGoodsType;
		$("#goShopingCart").on('tap', function() {
			//			alert("#goShopingCart");
			chooseGoodsType = 1;
			getShoppingData();
			//			gotoChoosePage();
		});
		$("#goChoosePage").on('tap', function() {
			chooseGoodsType = 2;
			getShoppingData();
			//			gotoChoosePage();
		});
		//用于判断是否点击过请求添加喜爱、收藏，正在请求时限制点击
		var hadClick_collect = false;
		var hadClick_like = false;
		//获取存储的页面数据
		var params = app.router.getParameter();
		var saved = app.router.getSavedData();
		if (saved.data) {
			showPage(saved.data);
		} else {
			getIntegralExchangeData();
		}
		app.weixin.registerWeixinConfig(window.location.href, function() {
			app.weixin.setWeixinMenuShare(window.location.href, {
				type: 1,
				goodsID: params.goodsID
			});
		});
	</script>

</html>
